# 核心工作流与自动复盘（AI 协作）

> **适用对象**: Codex / Cursor / Copilot / Gemini 等辅助编程 AI。
> 
> **本文件职责**：
> - 只负责“协作工作流（怎么做事）”与“自动复盘（怎么沉淀）”。
> - **不包含**具体编码规范与 Git 提交规范（已拆分到独立文档）。

## 1. 核心工作流（Vibe 循环）

> 约定：如果本次回答实际使用了 Milvus 做语义检索（RAG 注入），需要在回复第一行标记 `[RAG:Milvus] ...`（见 `docs/skills/milvus_rag_marker.md`）。

1. **环境探测 (Context Detection)**：生成代码前，先确认项目真实技术栈与入口。
2. **编码 (Coding)**：基于探测结果做最小可行改动（避免过度设计）。
3. **错误积累 (Accumulation)**：本地运行并收集完整日志。
4. **分析验证 (Verification)**：把“代码 + 日志 + 复现步骤”提交给分析环节定位根因。
5. **计划执行 (Planning)**：给出明确步骤并逐条验证。

> 最小环境探测清单与根目录判断规则见 `vibe_rules.md`。

## 2. 错误日志标准（写给 AI / 人类都能复现）

当你说“报错/异常/跑不起来/修 bug”时，必须提供：

- 命令（你执行了什么）
- 现象（你看到了什么）
- 完整报错栈（不要截断）
- 复现步骤（最少输入/最小场景）
- 相关配置片段（`package.json`/`tsconfig`/构建配置等）

模板（与 `vibe_rules.md` 保持一致）：

```
命令:
现象:
完整报错:
复现步骤:
相关配置:
```

## 3. 自动复盘（Retrospective）

### 3.1 何时必须记录
满足任一条件就要记录到 `retrospective.md`：
- 影响范围超过 1 个模块
- 修复耗时 > 30 分钟
- 涉及构建/运行时/依赖冲突交叉问题
- 连续两次试错仍无效

判定标准以 `vibe_rules.md` 为准。

### 3.2 记录格式（紧凑、可检索）

建议追加到 `retrospective.md` 末尾：

```markdown
- [YYYY-MM-DD] **{Title}**: {症状与根因} -> {解决方案}。
```

### 3.3 /retro 自动复盘

- 使用 `/retro`：走“快速、轻量”的追加模式（见 `docs/skills/auto-retro.md`）。
- 使用 `/retro --full`：触发深度复盘与维护（如归档/提炼）。

## 4. 相关规范文档（已拆分）

- 编码规范：`coding_rules.md`
- Git 提交规范：`git_commit_rules.md`

---
*Last Updated: 2026-01-15*
