<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Common | Knowledge Base</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Marked.js -->
    <script src="https://cdn.jsdelivr.net/npm/marked@4.3.0/marked.min.js"></script>
    <!-- GitHub Markdown Style (Base) -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/github-markdown-css/5.2.0/github-markdown-light.min.css" id="markdown-style">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        
        :root { font-family: 'Inter', system-ui, -apple-system, sans-serif; }
        
        .custom-scrollbar::-webkit-scrollbar { width: 4px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: transparent; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #e2e8f0; border-radius: 10px; }
        .dark .custom-scrollbar::-webkit-scrollbar-thumb { background: #334155; }

        .markdown-body { background-color: transparent !important; font-family: inherit !important; }
        
        /* Glass Effect */
        .glass {
            background: rgba(255, 255, 255, 0.7);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
        }
        .dark .glass {
            background: rgba(15, 23, 42, 0.8);
        }

        .nav-item-active {
            background: #eff6ff;
            color: #2563eb;
            font-weight: 600;
            border-right: 3px solid #2563eb;
        }
        .dark .nav-item-active {
            background: #1e293b;
            color: #60a5fa;
            border-right-color: #60a5fa;
        }
    </style>
    <script>
        tailwind.config = {
            darkMode: 'media',
            theme: {
                extend: {
                    colors: {
                        brand: {
                            50: '#eff6ff', 100: '#dbeafe', 200: '#bfdbfe', 300: '#93c5fd', 400: '#60a5fa',
                            500: '#3b82f6', 600: '#2563eb', 700: '#1d4ed8', 800: '#1e40af', 900: '#1e3a8a',
                        },
                    }
                }
            }
        }
    </script>
</head>
<body class="bg-slate-50 text-slate-900 dark:bg-slate-950 dark:text-slate-100 transition-colors duration-300">

    <!-- App Wrapper -->
    <div class="flex h-screen overflow-hidden">
        
        <!-- Sidebar -->
        <aside id="sidebar" class="w-72 flex-shrink-0 flex flex-col glass border-r border-slate-200 dark:border-slate-800 z-20">
            <!-- Header -->
            <div class="p-6 border-bottom border-slate-200 dark:border-slate-800">
                <div class="flex items-center space-x-2">
                    <div class="w-8 h-8 bg-brand-600 rounded-lg flex items-center justify-center text-white font-bold">A</div>
                    <h1 class="text-lg font-bold tracking-tight">AI Common</h1>
                </div>
                <div id="repo-tag" class="mt-2 text-xs font-mono text-slate-500 truncate">Loading...</div>
            </div>

            <!-- Scrollable Content -->
            <div class="flex-1 overflow-y-auto custom-scrollbar px-3 space-y-6 pb-6">
                <!-- Shortcuts -->
                <div>
                    <h2 class="px-3 text-xs font-semibold text-slate-400 uppercase tracking-wider mb-2">Âø´Êç∑ËÆøÈóÆ</h2>
                    <nav id="shortcuts" class="space-y-1">
                        <!-- Injected -->
                    </nav>
                </div>

                <!-- File Tree -->
                <div>
                    <h2 class="px-3 text-xs font-semibold text-slate-400 uppercase tracking-wider mb-2">È°πÁõÆÊñá‰ª∂</h2>
                    <nav id="tree-container" class="space-y-1">
                        <!-- Injected -->
                    </nav>
                </div>
            </div>

            <!-- Sidebar Footer -->
            <div class="p-4 bg-white/50 dark:bg-slate-900/50 border-t border-slate-200 dark:border-slate-800">
                <div class="text-xs font-medium text-slate-500 mb-2">üöÄ ÂàùÂßãÂåñÂëΩ‰ª§</div>
                <div class="group relative">
                    <code id="init-cmd" onclick="copyCmd(this.innerText)" class="block p-2 text-[10px] bg-slate-100 dark:bg-slate-800 rounded border border-slate-200 dark:border-slate-700 text-pink-600 dark:text-pink-400 cursor-pointer hover:border-brand-400 transition-colors break-all">
                        ~/Documents/AI_Common/init_vibe.sh
                    </code>
                    <span class="absolute -top-8 left-1/2 -translate-x-1/2 px-2 py-1 bg-slate-800 text-white text-[10px] rounded opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none">ÁÇπÂáªÂ§çÂà∂</span>
                </div>
            </div>
        </aside>

        <!-- Main Content -->
        <main id="main" class="flex-1 overflow-y-auto relative bg-white dark:bg-slate-950 custom-scrollbar">
            <!-- Content Area -->
            <div class="max-w-4xl mx-auto px-8 py-12 md:py-20">
                <article id="content" class="markdown-body transition-all duration-500 opacity-0 transform translate-y-4">
                    <!-- Markdown will render here -->
                </article>
            </div>

            <!-- Loading Overlay -->
            <div id="loader" class="absolute inset-0 flex items-center justify-center bg-white dark:bg-slate-950 z-10">
                <div class="flex flex-col items-center">
                    <div class="w-12 h-12 border-4 border-slate-200 border-t-brand-600 rounded-full animate-spin"></div>
                    <p class="mt-4 text-sm text-slate-500 animate-pulse">Ê≠£Âú®ÂêåÊ≠•Êï∞ÊçÆ...</p>
                </div>
            </div>
        </main>
    </div>

    <!-- Script Container -->
    <script>
        const STATE = {
            owner: 'webkubor',
            repo: 'AI_Common',
            branch: 'main',
            tree: []
        };

        const IGNORE_FILES = ['.DS_Store', '.gitignore', '.git', 'LICENSE', 'index.html', 'project_index.md'];
        
        const SHORTCUTS = [
            { name: 'Ë∑ØÁî±ÊÄªËßà', icon: 'üß≠', path: 'index.md' },
            { name: 'Â§çÁõòÂ∑•‰ΩúÊµÅ', icon: 'üî•', path: 'workflow_retro.md' },
            { name: 'PWA ÊîπÈÄ†', icon: '‚ö°', path: 'extensions/pwa_master.md' },
            { name: 'Codex Skills', icon: 'ü§ñ', path: 'extensions/codex_skills_protocol.md' },
            { name: 'Gemini Skills', icon: '‚ôä', path: 'extensions/gemini_skills_protocol.md' },
            { name: 'ÊäÄÊúØÊ†àÂÅèÂ•Ω', icon: '‚öôÔ∏è', path: 'tech_stack.md' }
        ];

        const els = {
            repoTag: document.getElementById('repo-tag'),
            tree: document.getElementById('tree-container'),
            shortcuts: document.getElementById('shortcuts'),
            content: document.getElementById('content'),
            loader: document.getElementById('loader')
        };

        async function init() {
            const hostname = window.location.hostname;
            const pathParts = window.location.pathname.split('/').filter(p => p);

            if (hostname.endsWith('github.io') && pathParts.length > 0) {
                STATE.owner = hostname.split('.')[0];
                STATE.repo = pathParts[0]; 
            }
            await loadRepo();
        }

        async function loadRepo() {
            els.repoTag.innerText = `${STATE.owner}/${STATE.repo}`;
            try {
                const apiUrl = `https://api.github.com/repos/${STATE.owner}/${STATE.repo}/git/trees/${STATE.branch}?recursive=1`;
                const res = await fetch(apiUrl);
                if (!res.ok) throw new Error("API Limit or Repo Error");
                
                const data = await res.json();
                STATE.tree = data.tree.filter(item => {
                    const name = item.path.split('/').pop();
                    return !name.startsWith('.') && !IGNORE_FILES.includes(name);
                });

                renderSidebar();
                const readme = STATE.tree.find(f => f.path.toLowerCase() === 'index.md');
                if (readme) loadFile(readme.path);

            } catch (err) {
                showError(err.message);
            }
        }

        function renderSidebar() {
            // Shortcuts
            els.shortcuts.innerHTML = '';
            SHORTCUTS.forEach(s => {
                const btn = createNavItem(`${s.icon} ${s.name}`, () => {
                    loadFile(s.path);
                    updateActiveItem(btn);
                });
                els.shortcuts.appendChild(btn);
            });

            // Tree
            els.tree.innerHTML = '';
            STATE.tree.sort((a, b) => a.type === b.type ? a.path.localeCompare(b.path) : (a.type === 'tree' ? -1 : 1));
            
            STATE.tree.forEach(item => {
                const name = item.path.split('/').pop();
                const depth = item.path.split('/').length - 1;
                const icon = item.type === 'tree' ? 'üìÅ' : 'üìÑ';
                
                const btn = createNavItem(`${icon} ${name}`, () => {
                    if (item.type === 'blob') {
                        loadFile(item.path);
                        updateActiveItem(btn);
                    }
                }, depth);
                els.tree.appendChild(btn);
            });
        }

        function createNavItem(html, onClick, depth = 0) {
            const btn = document.createElement('button');
            btn.className = `w-full text-left px-3 py-2 rounded-lg text-sm transition-all hover:bg-slate-100 dark:hover:bg-slate-800 flex items-center space-x-2 text-slate-600 dark:text-slate-400`;
            btn.style.paddingLeft = `${depth * 12 + 12}px`;
            btn.innerHTML = html;
            btn.onclick = onClick;
            return btn;
        }

        function updateActiveItem(target) {
            document.querySelectorAll('button').forEach(b => b.classList.remove('nav-item-active'));
            target.classList.add('nav-item-active');
        }

        async function loadFile(path) {
            els.content.classList.add('opacity-0', 'translate-y-4');
            els.loader.classList.remove('hidden');
            
            const rawUrl = `https://raw.githubusercontent.com/${STATE.owner}/${STATE.repo}/${STATE.branch}/${path}`;
            try {
                const res = await fetch(rawUrl);
                const text = await res.text();
                
                setTimeout(() => {
                    els.content.innerHTML = path.endsWith('.md') ? marked.parse(text) : `<pre class="p-4 bg-slate-50 dark:bg-slate-900 rounded-xl overflow-x-auto text-xs"><code>${text}</code></pre>`;
                    els.loader.classList.add('hidden');
                    els.content.classList.remove('opacity-0', 'translate-y-4');
                    document.getElementById('main').scrollTop = 0;
                }, 300);
            } catch (err) {
                showError("Êñá‰ª∂Âä†ËΩΩÂ§±Ë¥•");
            }
        }

        function showError(msg) {
            els.content.innerHTML = `<div class="py-20 text-center"><h2 class="text-2xl font-bold text-red-500">Oops!</h2><p class="text-slate-500 mt-2">${msg}</p></div>`;
            els.loader.classList.add('hidden');
            els.content.classList.remove('opacity-0');
        }

        function copyCmd(text) {
            navigator.clipboard.writeText(text);
            const code = document.getElementById('init-cmd');
            const original = code.innerText;
            code.innerText = "Â∑≤Â§çÂà∂Âà∞Ââ™Ë¥¥ÊùøÔºÅ";
            code.classList.add('text-green-500', 'border-green-500');
            setTimeout(() => {
                code.innerText = original;
                code.classList.remove('text-green-500', 'border-green-500');
            }, 1500);
        }

        init();
    </script>
</body>
</html>